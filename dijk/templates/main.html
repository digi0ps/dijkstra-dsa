<!DOCTYPE HTML>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Dijkstra's Shortest Path</title>
	{% load static %}
	<link href="{% static 'css/pretty.css' %}" rel="stylesheet" type="text/css" />
</head>
<body>

	<section class="hero is-dark">
	  <div class="hero-body">
	    <div class="container">
	      <h1 class="title">Dijkstra's Shortest Path</h1>
	      <h2 class="subtitle">Using <b>javascript</b> and <b>D3.js</b></h2>
	    </div>
	  </div>
	</section>

	<section class="hero is-light">
	  <div class="hero-body">
	    <div class="container">
			<h1 class="title">Number of nodes</h1>
			<h2 class="subtitle less-bottom-margin">From 1 to 20</h2>
			<center>
				<input class="input node-input is-large" type="number" id="numberOfNodes" name="sp-nodes" value="5"/>
				<a class="button is-success is-large" onclick="ShortestPathUtils.makeTable(document.getElementById('numberOfNodes').value);">Make Table <i class="feather" data-feather="grid"></i></a>
			</center>
	    </div>
	  </div>
	</section>

	<section class="hero">
	  <div class="hero-body">
	    <div class="container">
			<div id="distances2"></div>
			<div id="results2"></div>
			<div id="graph2" class="spgraph" ></div>
	    </div>
	  </div>
	</section>

	<section class="hero">
	  <div class="hero-body">
	    <div class="container">
			<div id="distances"></div>
			<div id="results"></div>
			<div id="graph" class="spgraph" ></div>
	    </div>
	  </div>
	</section>
	
	<link href="{% static 'css/shortest-path.css' %}" rel="stylesheet" type="text/css" />
	
	<script type="text/javascript" src="{% static 'js/d3.v3.min.js' %}"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script type="text/javascript" src="{% static 'js/ShortestPathCalculator.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/ShortestPathUtils.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/feather.js' %}"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			var is_complete = 0;
			var nodes = new Array();
			var paths = new Array();

			var on_complete = function() {
				if (is_complete < 2) return;
				console.log("done reading files");
				var sp1 = new ShortestPathCalculator(nodes, paths);

				var route = sp1.findRoute(0, 6);

				var result = sp1.formatResult();

				document.getElementById("results").innerHTML = result;

				sp1.drawGraph("graph");
			};

			$.get("nodes.txt", function(data) {
				arr = data.split("\n");
				arr.forEach(function(element, index, array) {
					nodes.push(JSON.parse(element));
				});
				is_complete++;
				on_complete();
			});
			$.get("paths.txt", function(data) {
				arr = data.split("\n");
				arr.forEach(function(element, index, array) {
					paths.push(JSON.parse(element));
				});
				is_complete++;
				on_complete();
			});
		});
	</script>
</body>
</html>